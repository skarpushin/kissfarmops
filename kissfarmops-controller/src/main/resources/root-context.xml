<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:security="http://www.springframework.org/schema/security" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:p="http://www.springframework.org/schema/p" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:cache="http://www.springframework.org/schema/cache"
	xsi:schemaLocation="
	http://www.springframework.org/schema/mvc 
	http://www.springframework.org/schema/mvc/spring-mvc.xsd
	http://www.springframework.org/schema/cache 
	http://www.springframework.org/schema/cache/spring-cache.xsd
	http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/context 
	http://www.springframework.org/schema/context/spring-context.xsd
	http://www.springframework.org/schema/tx
    http://www.springframework.org/schema/tx/spring-tx.xsd
	http://www.springframework.org/schema/security
    http://www.springframework.org/schema/security/spring-security.xsd
    http://www.springframework.org/schema/aop
    http://www.springframework.org/schema/aop/spring-aop.xsd">

	<context:annotation-config />

	<bean id="props" class="org.summerb.utils.spring.ExposePropertyPlaceholderConfigurer" p:ignoreResourceNotFound="true"
		p:ignoreUnresolvablePlaceholders="true">
		<property name="locations">
			<list>
				<!-- Default configuration values -->
				<value>classpath:application.properties</value>
				<value>file:application-override-*.properties</value>
				<!-- Deployment-specific configuration values that override defaults -->
				<value>file:/opt/kf-ctrl/conf/kf-ctrl.properties</value>
			</list>
		</property>
	</bean>

	<bean id="messageSource" class="org.summerb.utils.spring.MessageSourceExposableImpl">
		<qualifier value="messageSource" />
		<property name="basenames">
			<list>
				<value>classpath:org/springframework/security/messages</value>
				<value>classpath:security-messages</value>
				<value>classpath:summerb-messages</value>
				<value>classpath:service-users-messages</value>
				<value>classpath:service-articles-messages</value>
				<value>/WEB-INF/messages/kf-ctrl-webapp-messages</value>
			</list>
		</property>
		<property name="cacheSeconds" value="5" />
		<property name="defaultEncoding" value="UTF-8" />
		<property name="fallbackToSystemLocale" value="false" />
	</bean>

	<bean id="executorService" class="java.util.concurrent.Executors" factory-method="newCachedThreadPool" destroy-method="shutdownNow" />
	<bean id="scheduledExecutorService" class="java.util.concurrent.Executors" factory-method="newScheduledThreadPool" destroy-method="shutdownNow">
		<constructor-arg value="4" />
	</bean>

	<bean id="entityChangesEventBus" class="com.google.common.eventbus.EventBus" />

	<bean class="org.summerb.utils.exceptions.translator.ExceptionTranslatorLegacyImpl" />
	<bean class="org.summerb.utils.exceptions.translator.ExceptionTranslatorSimplifiedCurrentRequestImpl" />

	<import resource="data-source-context.xml" />
	<import resource="properties-context.xml" />
	<import resource="users-context.xml" />
	<import resource="spring-security-context.xml" />
	<import resource="easy-crud-commons.xml" />
	<import resource="services.xml" />
	<import resource="integration.xml" />

	<bean id="absoluteUrlBuilder" class="org.summerb.approaches.springmvc.utils.AbsoluteUrlBuilderDefaultImpl" />
	<bean id="securityActionsUrlsProvider" class="org.summerb.approaches.springmvc.security.mvc.SecurityActionsUrlsProviderDefaultImpl" />
	<bean class="org.kissfarm.shared.impl.CompressorTarGzImpl" />

	<bean id="facadeMonitoringAdvisor" class="net.bull.javamelody.MonitoringSpringAdvisor">
		<property name="pointcut">
			<bean class="org.springframework.aop.support.JdkRegexpMethodPointcut">
				<property name="pattern" value=".*Impl.*" />
			</bean>
		</property>
	</bean>

	<bean id="sessionRepository" class="org.springframework.session.MapSessionRepository">
	</bean>

	<bean id="httpSessionStrategy" class="org.springframework.session.web.http.CookieHttpSessionStrategy">
		<property name="cookieSerializer">
			<bean class="org.springframework.session.web.http.DefaultCookieSerializer" p:cookieName="${security.session.cookie.name}" />
		</property>
	</bean>
	<bean id="springSessionRepositoryFilter" class="org.springframework.session.web.http.SessionRepositoryFilter">
		<constructor-arg ref="sessionRepository" />
		<property name="httpSessionStrategy" ref="httpSessionStrategy" />
	</bean>

</beans>
